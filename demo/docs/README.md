# Demo Game - ボール移動デモ

GameBoy Advance用のシンプルなデモゲームです。
共通ライブラリの使い方を示すサンプルとして作成されています。

## ゲーム内容

プレイヤーは赤いボールを操作して画面内を自由に移動できます。
背景には星が散りばめられています。

## 操作方法

### 基本操作

- **十字キー上下左右**: ボールを移動
- **Aボタン**: ボールの色を変更
- **Bボタン**: 星の色をランダムに変更
- **Start + Select**: ゲーム終了

## ゲーム仕様

### ボール

- **サイズ**: 半径8ピクセルの円
- **初期位置**: 画面中央（120, 80）
- **初期色**: 赤
- **移動速度**: 1フレームあたり2ピクセル
- **画面端の処理**: 画面端で止まる（反射なし）

### 星

- **数**: 50個
- **位置**: ランダム配置
- **色**: 初期は白、Bボタンでランダムな色に変更
- **動作**: 固定（動かない）

### UI

- **タイトルバー**: 画面上部に暗いグレーのバー
- **フレームカウンター**: タイトルバー右側に緑のドットで表示（0-9の範囲で繰り返し）

## 技術仕様

### 使用している共通ライブラリ

#### gba/display
```go
display.SetMode(display.Mode3)          // Mode 3（ビットマップモード）
display.EnableLayers(display.EnableBG2) // BG2を有効化
display.WaitForVBlank()                 // VBlank待機
```

#### gba/graphics
```go
graphics.ClearScreen(graphics.ColorBlack)           // 画面クリア
graphics.DrawPixel(x, y, graphics.ColorWhite)       // ピクセル描画（星）
graphics.FillCircle(x, y, radius, color)            // 円の塗りつぶし（ボール）
graphics.FillRect(x, y, width, height, color)       // 矩形塗りつぶし（UI）
```

#### gba/input
```go
keys := input.NewKeyState()    // 入力状態管理を初期化
keys.Update()                  // 入力状態を更新（毎フレーム）
keys.IsHeld(input.KeyUp)       // キーが押され続けているか
keys.IsPressed(input.KeyA)     // キーが押された瞬間か
```

#### math
```go
math.SetSeed(12345)                    // 乱数シードを設定
math.RandInt(graphics.ScreenWidth)     // 0-239の乱数
```

### データ構造

#### Ball構造体
```go
type Ball struct {
    x, y   int32   // 位置
    vx, vy int32   // 速度
    color  uint16  // 色（15bit RGB）
}
```

#### Star構造体
```go
type Star struct {
    x, y  int32   // 位置
    color uint16  // 色（15bit RGB）
}
```

### メインループ

```
1. VBlank待機
2. 入力更新
3. ゲーム終了チェック
4. ボール更新
5. 画面クリア
6. 星を描画
7. ボールを描画
8. UI描画
9. フレームカウンター増加
```

## ビルド方法

### デモゲームディレクトリで

```bash
# ビルド
make build

# ビルドして実行
make run

# 高速ビルド（最適化なし）
make quick

# クリーンアップ
make clean
```

### プロジェクトルートから

```bash
# デモゲームをビルド
make build-demo

# デモゲームを実行
make run-demo
```

## ファイル構成

```
demo/
├── main.go           # メインプログラム
├── go.mod            # Goモジュール定義
├── Makefile          # ビルドスクリプト
└── docs/
    └── README.md     # このファイル
```

## 学習ポイント

このデモゲームから以下を学べます：

1. **ディスプレイ初期化**: Mode 3の設定方法
2. **入力処理**: キー入力の取得と状態管理
3. **描画処理**: ピクセル、円、矩形の描画
4. **VBlank管理**: 画面のちらつきを防ぐタイミング制御
5. **ゲームループ**: 入力→更新→描画のサイクル
6. **構造体の使用**: ゲームオブジェクトの管理方法
7. **乱数生成**: ランダムな配置や色の生成

## 拡張アイデア

このデモをベースに以下のような拡張が可能です：

- ボールを複数にする
- 星をアニメーションさせる（点滅、移動）
- ボールの軌跡を描画する
- 衝突判定を追加する
- スコア表示を追加する
- サウンドを追加する
- パーティクルエフェクトを追加する

## パフォーマンス

- **描画モード**: Mode 3（240×160、16bit color）
- **フレームレート**: 60 FPS（VBlank同期）
- **使用メモリ**:
  - ビデオバッファ: 75 KB（240×160×2バイト）
  - プログラム: 数KB程度

## 既知の制限

- テキスト描画機能がないため、数値やメッセージをドットで表現
- Mode 3は全画面を毎フレーム更新するため、複雑な描画には不向き
- 浮動小数点演算が使えない（今回は整数のみで実装）

## 次のステップ

より高度なゲームを作る場合：

1. **Mode 0を使用**: タイルベースの背景とスプライト
2. **DMAを活用**: 大量データの高速転送
3. **固定小数点演算**: より正確な物理演算
4. **サウンド追加**: BGMや効果音
5. **セーブ機能**: SRAMへのデータ保存
