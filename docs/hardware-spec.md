# GameBoy Advance ハードウェア仕様書

## 概要

GameBoy Advance (GBA)は任天堂が2001年にリリースした携帯型ゲーム機です。
32bit ARMプロセッサを搭載し、前世代のGameBoy/GameBoy Colorとの互換性を持ちます。

## CPU

### メインCPU
- **プロセッサ**: ARM7TDMI (ARMv4T)
- **動作周波数**: 16.78 MHz
- **ビット幅**: 32bit
- **命令セット**:
  - ARM命令セット（32bit命令）
  - Thumb命令セット（16bit命令）

### 互換性用CPU
- **プロセッサ**: Z80相当
- **動作周波数**: 4 MHz または 8 MHz
- **用途**: GameBoy/GameBoy Color互換モード

## メモリ構成

### IWRAM (Internal Work RAM)
- **容量**: 32 KB
- **バス幅**: 32bit
- **アドレス**: 0x03000000 - 0x03007FFF
- **用途**: ARM命令コードの格納に最適

### EWRAM (External Work RAM)
- **容量**: 256 KB
- **バス幅**: 16bit
- **アドレス**: 0x02000000 - 0x0203FFFF
- **用途**: Thumb命令コードやデータの格納に最適

### VRAM (Video RAM)
- **容量**: 96 KB
- **バス幅**: 16bit
- **アドレス**: 0x06000000 - 0x06017FFF
- **用途**: グラフィックスデータ（スプライト、背景など）

### パレットRAM
- **容量**: 1 KB
- **バス幅**: 16bit
- **アドレス**: 0x05000000 - 0x050003FF
- **用途**: カラーパレットデータ

### OAM (Object Attribute Memory)
- **容量**: 1 KB
- **バス幅**: 32bit
- **アドレス**: 0x07000000 - 0x070003FF
- **用途**: スプライトの属性情報

### BIOS ROM
- **容量**: 16 KB
- **アドレス**: 0x00000000 - 0x00003FFF
- **用途**: システムROM（起動処理など）

### ゲームパックROM
- **最大容量**: 32 MB
- **バス幅**: 16bit
- **アドレス**: 0x08000000 - （可変）
- **用途**: ゲームプログラムとデータ

### ゲームパックRAM (SRAM/Flash)
- **アドレス**: 0x0E000000 - （可変）
- **用途**: セーブデータ

## グラフィックス

### ディスプレイ
- **解像度**: 240 × 160 ピクセル
- **色深度**: 15bit RGB (各色5bit)
- **最大表示色数**: 32,768色

### グラフィックスモード

#### キャラクタモード
- **Mode 0**: 4つの静的レイヤー
- **Mode 1**: 3つのレイヤー（1つはアフィン変換対応）
- **Mode 2**: 2つのアフィン変換対応レイヤー
- **表示可能色数**: 同時に512色

#### ビットマップモード
- **Mode 3**: フルサイズ（240×160）、フルカラー（32,768色）、1フレーム
- **Mode 4**: フルサイズ（240×160）、256色、2フレーム
- **Mode 5**: ハーフサイズ（160×128）、フルカラー（32,768色）、2フレーム

### スプライト
- **最大スプライト数**: 128個
- **サイズ**: 8×8 から 64×64 ピクセル
- **機能**: 回転、拡大縮小、半透明

## サウンド

- **音源チャンネル数**: 6チャンネル
  - DMGサウンド互換: 4チャンネル（矩形波×2、ウェーブテーブル×1、ノイズ×1）
  - DirectSound: 2チャンネル（8bit PCM）

## I/Oレジスタ

- **アドレス**: 0x04000000 - 0x040003FF
- **サイズ**: 1 KB
- **用途**: ハードウェア制御レジスタ（グラフィックス、サウンド、DMA、タイマーなど）

## ROM形式

### ROMヘッダ構造
- **サイズ**: 192バイト
- **オフセット 0x00**: ARM分岐命令（4バイト）
- **オフセット 0x04**: 任天堂ロゴ（156バイト、必須）
- **オフセット 0xA0**: ゲームタイトル（最大12バイト）
- **オフセット 0xAC**: ゲームコード（4バイト）
- **オフセット 0xBD**: ヘッダチェックサム（必須）

チェックサムが正しくない場合、ROMは起動しません。

## 参考資料

- [Game Boy Advance Architecture | A Practical Analysis](https://www.copetti.org/writings/consoles/game-boy-advance/)
- [Tonc: GBA Hardware](https://www.coranac.com/tonc/text/hardware.htm)
- [GBATEK - GBA/NDS Technical Info](http://problemkaputt.de/gbatek.htm)
- [GBA Memory Map](https://gbadev.net/gbadoc/memory.html)
